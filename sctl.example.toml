# gosctl configuration
# Copy to ~/.config/gosctl/sctl.toml (global) or ./sctl.toml (local)

[hosts.web1]
address = "web1.example.com"
user = "deploy"
# port = 22                        # Default: 22
# key_file = "~/.ssh/id_ed25519"   # Optional, uses SSH agent or default keys

[hosts.web2]
address = "web2.example.com"
user = "deploy"

[hosts.dbserver]
address = "db.example.com"
port = 2222
user = "admin"
key_file = "/path/to/special/key"

# Single host task
[tasks.deploy-web1]
host = "web1"
workdir = "/var/www/app"
steps = [
    "git pull origin main",
    "systemctl --user restart app",
]

# Multiple hosts task (runs sequentially)
[tasks.deploy-all]
hosts = ["web1", "web2"]
workdir = "/var/www/app"
steps = [
    "git pull origin main",
    "systemctl --user restart app",
]

# Task with before/after dependencies
[tasks.deploy-safe]
hosts = ["web1", "web2"]
before = ["backup-db"]           # Run backup first
workdir = "/var/www/app"
steps = [
    "git pull origin main",
    "npm install --production",
    "systemctl --user restart app",
]
after = ["notify-slack"]         # Notify after completion

[tasks.backup-db]
host = "dbserver"
steps = [
    "pg_dump mydb > /backup/mydb-$(date +%Y%m%d).sql",
    "gzip /backup/mydb-$(date +%Y%m%d).sql",
]

[tasks.notify-slack]
host = "web1"
steps = [
    "curl -X POST -d 'Deployment complete' https://hooks.slack.com/...",
]
